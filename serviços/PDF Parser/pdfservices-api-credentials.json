document.getElementById("file_uploader_nfe").getElementsByTagName("input")[0].click()


tranferência de saldo
---------------------
o saldo é da linha
o saldo do centro de custo é um saldo virtual
    - soma de todos os saldos de todas as linhas
caso um valor seja emprestado, ele sai da linha - e automaticamente do centro de custo - mas deve ficar registrado, pois de alguma forma o gestor da linha gerou saving
    - o saving deve ser a soma do que foi emprestado + o saving atual da linha
caso um valor seja recebido, ele é somado ao valor inicial porém existe como um valor separado, a fim de calcular em quanto o orçamento precisou ser aumentado
    - serve para saber o valor desta mesma linha no próximo orçamento



criar um tipo de distribuição onde se coloca um valor e o mesmo é repetido em todas as linhas
    com possibilidade de aumeto em algum mês (em valor ou %)

"https://keeptargets.s3.amazonaws.com/budget/upload/nfse/leonardo.pdf",
"https://keeptargets.s3.amazonaws.com/budget/upload/nfse/RD.pdf",
"https://keeptargets.s3.amazonaws.com/budget/upload/nfse/RPS___________36056.pdf",
"https://keeptargets.s3.amazonaws.com/budget/upload/nfse/4bfe7f4e-886d-4fcd-a35c-ae5411b0de47.pdf",
"https://keeptargets.s3.amazonaws.com/budget/upload/nfse/NF-e_-_Nota_Fiscal_Eletrônica_de_Serviços_-_São_Paulo.pdf;sucessoNFSe_00068994_03126536.pdf",
"https://keeptargets.s3.amazonaws.com/budget/upload/nfse/NFSe_00068994_03126536.pdf;sucesso"

[
  {
    success: true,
    data: "CNPJ: NÃO ENCONTRADO;Data: NÃO ENCONTRADO;Valor: NÃO ENCONTRADO;Referência: NÃO ENCONTRADO"
  },
]


e ao invés de retornar result.success, quero retornar o seguinte:
se não houver nenhuma string 'NÃO ENCONTRADO' em result.data, retornar Sucesso 
se houver 4 strings'NÃO ENCONTRADO' em result.data, retornar Falha
se não encaixar na situação 1 ou 2, retornar Falha parcial 


// Cria o input do tipo file
const fileInput = document.createElement('input');
fileInput.type = 'file';
fileInput.accept = 'application/pdf'; // Aceita apenas arquivos PDF
fileInput.multiple = true; // Permite selecionar múltiplos arquivos

// Variável para armazenar a lista de arquivos
let fileList = [];

// Evento para capturar os arquivos selecionados
fileInput.addEventListener('change', (event) => {
    const files = event.target.files;

    if (files.length > 0) {
        // Converte a lista de arquivos para um array de strings contendo o nome do arquivo
        fileList = Array.from(files).map(file => file.name.replaceAll(" ", "_")); // Armazena apenas os nomes dos arquivos
        
        // Chama a função para gerar as URLs pré-assinadas e fazer o upload
        generatePresignedUrls(fileList, files);  // Passando também o array de arquivos para validação
    }
});

// Dispara o diálogo de seleção de arquivos
fileInput.click();

// Função para gerar URLs pré-assinadas
function generatePresignedUrls(fileList, files) {
    const uploadPromises = fileList.map((name, index) => {
        return fetch('https://8qo9zlerhj.execute-api.sa-east-1.amazonaws.com/prod/geraurlassinada', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ fileName: name, fileType: files[index].type })
        })
        .then(response => response.json())
        .then(data => {
            // Caso o tipo de arquivo seja inválido
            if (data.status && data.status === 'falha: Tipo de arquivo inválido') {
                return {
                    fileName: data.fileName,
                    fileUrl: null,
                    status: "Falha", // "falha: Tipo de arquivo inválido"
                    mensagem: error.message
                };
            }

            const presignedUrl = data.presignedUrl;
            const fileUrl = data.fileUrl;
            
            if (!presignedUrl || !fileUrl) {
                return {
                    fileName: data.fileName,
                    fileUrl: null,
                    status: "Falha", // "falha: Tipo de arquivo inválido"
                    mensagem: "URL não retornada"
                };
                // throw new Error(`URL não retornada para ${name}`);
            }

            // Realiza o upload do arquivo para o S3
            return uploadFileToS3(name, presignedUrl, files[index]).then(() => ({
                fileName: name,
                fileUrl: fileUrl,
                status: 'Sucesso',
                mensagem: 'Pronto para importar'
            }));
        })
        .catch(error => {
            console.error(`Erro ao processar o arquivo ${name}:`, error);
            return {
                fileName: name,
                fileUrl: null,
                status: "Falha",
                mensagem: error.message
            }
        });
    });

    Promise.all(uploadPromises)
        .then((uploadedFiles) => {
            var situacao = ""

            const fileUrls = uploadedFiles.map(file => {
                // Valida se processo terminou com sucesso, falha parcial ou geral
                const notFoundCount = (file.status.match(/Falha/g) || []).length; // Conta as ocorrências de 'NÃO ENCONTRADO'
                situacao = notFoundCount === 0
                    ? "Sucesso"
                    : notFoundCount === 4
                    ? "Falha"
                    : "Falha parcial";
    
                return `${file.mensagem};${file.fileName};${file.fileUrl || 'null'};${file.status}`;
            });
            
            fileUrls.unshift(situacao)
            bubble_fn_fileList(fileUrls); // Envia a lista final para o Bubble
        })
        .catch(error => {
            console.error('Erro durante o processamento dos arquivos:', error);
        });
    
}

// Função para upload do arquivo para o S3
function uploadFileToS3(fileName, presignedUrl, file) {
    return fetch(presignedUrl, {
        method: 'PUT',
        headers: {
            'Content-Type': file.type,
        },
        body: file,
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Erro no upload para o S3');
        }
    });
}


upload
------

Bubble
Tipo de arquivo inválido
Erro no upload para o S3
URL de upload não retornada
Arquivo carregado com sucesso

Lambda
Tipo de arquivo inválido
O corpo da requisição está ausente
A URL pré-assinada não foi gerada corretamente
Verifique se a nota contém todas as informações


Olá Elaine, bom dia, tudo bem? Excelente 2025 para você, muita saúde e prosperidade.

Apliquei para a posição de Diretor de Engenharia na Acerto, fico grato se puder encaminhar a eles meu currículo e informações.

Abs e bom dia
Luciano.



Point-in-time data recovery
Log visibility
Data Encryption
User-defined privacy
Advanced DDoS protection
HTTPS encryption
API authentication
Password vault



{
    "arquivo": "4bfe7f4e-886d-4fcd-a35c-ae5411b0de47.pdf",
    "request": {
        "model": "gpt-4o-mini",
        "messages": [
            {
                "role": "user",
                "content": "Extraia o CNPJ do prestador, a data de prestação do serviço e o valor do serviço da seguinte nota fiscal eletrônica (nfse)\n                                    <<NFS-e>>\n                                    Esta nota fiscal foi assinada digitalmente utilizando um certificado ICP-Brasil. ,Página 1/1 ,PREFEITURA MUNICIPAL DE GRAMADO ,383809 396030 Data da emissão da notaSecretaria Municipal da Fazenda Número da notaNúmero do RPS ,Nota Fiscal de Serviços Eletrônica - NFS-e ,04/11/2023 12:49:41 ,Data do fato gerador Código de verificação ,04/11/2023 00:00:00 ,IPWTFZAKK ,PRESTADOR DE SERVIÇOS ,Nome fantasia: ,Nome/Razão social:MINI MUNDO COMERCIO E SERVICOS DE TURISMO LTDA. ,CPF/CNPJ:89.846.042/0001-51 Inscrição municipal:25921 ,Endereço: HORACIO CARDOSO Número: 291 Bairro: PLANALTO CEP: 95670-000 ,Complemento: ,Município: Gramado UF: RS E-mail: Site: ,Inscrição estadual:0560014708 ,Telefone:(54) 3286-4055 ,Celular: ,TOMADOR DE SERVIÇOS ,Nome fantasia: ,Nome/Razão social: LUCIANO RABOTTINI ,CPF/CNPJ: 024.850.227-12 Inscrição municipal: Inscrição estadual: Complemento: ,Endereço: RUA EUSEBIO DE PAIVA CEP: 05054-080 ,Município: São Paulo UF: SP ,E-mail: lrabottini@gmail.com Telefone: Celular: ,DISCRIMINAÇÃO DOS SERVIÇOS ,Valor unitário ,Qtd ,Valor do serviço ,Base de cálculo (%) ISS ,INGRESSO INTEIRO, INGRESSO MEIO E INGRESSO SENIOR. ,265,0000 ,1,0000 ,265,0000 ,265,00x3,00 = 7,95 ,Forma de Pagamento ,Parcela Vencimento Tipo ,Valor (R$) ,Parcela Vencimento Tipo ,Valor (R$) ,Parcela Vencimento Tipo Valor (R$) ,RETENÇÕES FEDERAIS ,PIS/PASEP ,R$ 0,00 ,COFINS ,INSS ,IR ,CSLL ,Outras retenções ,R$ 0,00 ,R$ 0,00 ,R$ 0,00 ,R$ 0,00 ,R$ 0,00 ,Valor bruto dos serviços = R$ 265,00 ,Valor Acréscimo (TTS) = R$ 0,00 ,Valor Total = R$ 265,00 ,Códigos dos serviços: ,12.05 - Parques de diversões, centros de lazer e congêneres. ,Desc. condicionado(R$) 0,00 ,Desc. incondicionado(R$) 0,00 ,Deduções(R$) ,0,00 ,Base de cálculo(R$) ,Valor ISS(R$) ,265,00 ,7,95 ,OUTRAS INFORMAÇÕES ,Natureza da operação: Tributação no município ,Situação tributária do ISSQN: Normal ,Local da prestação do serviço: Gramado ,. ,O crédito gerado estará disponível somente após o recolhimento do ISS desta NFS-e. Situação desta NFS-e: Normal ,Verificar autenticidade ,https://e-gov.betha.com.br/e-nota/visualizarnotaeletronica?link=16991129810653960306368293060775781334442827302305718 Valor aproximado do tributo federal - R$ 35,64 (13,45%), estadual - R$ 0,00 (0,00%), municipal - R$ 11,98 (4,52%) , com base na Lei 12.741/2012 e no Decreto 8.264/2014 - Fonte: IBPT \n                                    <<Fim NFS-e>>\n                                    Responda se algum dos valores da lista 336336,11373920,1036299836,00037320,8177 aparece na nota.\n                                    Você deve responder sempre no formato abaixo, sem introduções ou explicações adicionais:\n                                    Referência: [valor da lista encontrado no texto];CNPJ: XXX.XXX.XXX/XXXX-XX;Data: DD/MM/AAAA;Valor: R$ XXX,XX\n                                    Se não encontrar algum dos campos, insira \"NÃO ENCONTRADO\".\n                                    Responda estritamente no formato especificado"
            }
        ],
        "max_tokens": 100,
        "temperature": 0
    }
}

{
    "arquivo": "leonardo.pdf",
    "request": {
        "model": "gpt-4o-mini",
        "messages": [
            {
                "role": "user",
                "content": "Extraia o CNPJ do prestador, a data de prestação do serviço e o valor do serviço da seguinte nota fiscal eletrônica (nfse)\n                                    <<NFS-e>>\n                                    12/24/24, 1 :02 AM ,NF-e -Nota Fiscal Eletronica de Servicos -Sao Paulo ,Ł PREFEITURA DO MUNICIPIO DE SAO PAULO Numero da Nota 00000153 SECRETARIA MUNICIPAL DA FAZENDA Data e Hora de Emissao NOTA FISCAL ELETRONICA DE SERVICOS -NFS-e 08/11/2016 13:49:13 Codigo de Verificacao 20241224u17101766000165 LHQW-PYV2 PRESTADOR DE SERVICOS CPF/CNPJ 17.101.766/0001-65 Inscricao Municipal 4.652.677-3 Nome/Razao Social: LEONARDO SENATORE DE SA COSTA ME Endereco R JEQUITINHONHA 00109 -BELENZINHO -CEP: 03021-040 Municipio: Sao Paulo UFSP TOMADOR DE SERVICOS Nome/Razao Social: LUCIANO RABQTTINI CPF/CNPJ: 024.850.227-12 Inscricao Municipal ----Endereco Rua Rua Xavier Gouveia 293, ap 92 -Parque Colonial -CEP: 04610-011 Municipio: Sao Paulo UF:SP E-mail: Irabottini@gmail.com INTERMEDIARIO DE SERVICOS CPF/CNPJ ----Nome/Razao Social:----DISCRIMINACAO DOS SERVICOS 01 roda C4 pallas VALOR TOTAL DO SERVICO = R$ 330,00 INSS (RS) I IRRF (R$) I CSLL (RS) I COFINS (RE) I PIS/PASEP (RE) -----Codigo do Servico 07676 -Funilaria e lanternagem, incluindo a pintura. Valor Total das DeduŁ6es (R$) I Base de Calculo (RE) I Aliquota (%) I Valor do ISS (RS) Credito (RE) 0 00 7% 7% 7% 2.97 Municipio da Prestacao do Servico I Numero Inscricao da Obra I Valor Aproximado dos Tributos / Fonte ---OUTRAS INFORMACOES (1) Esta NFS-e for emitida com respaldo na Lei n° 14.097/2005\n                                    <<Fim NFS-e>>\n                                    Responda se algum dos valores da lista 336336,11373920,1036299836,00037320,8177 aparece na nota.\n                                    Você deve responder sempre no formato abaixo, sem introduções ou explicações adicionais:\n                                    Referência: [valor da lista encontrado no texto];CNPJ: XXX.XXX.XXX/XXXX-XX;Data: DD/MM/AAAA;Valor: R$ XXX,XX\n                                    Se não encontrar algum dos campos, insira \"NÃO ENCONTRADO\".\n                                    Responda estritamente no formato especificado"
            }
        ],
        "max_tokens": 100,
        "temperature": 0
    }
}